var __assign=this&&this.__assign||function(){__assign=Object.assign||function(t){for(var s,i=1,n=arguments.length;i<n;i++){s=arguments[i];for(var p in s)if(Object.prototype.hasOwnProperty.call(s,p))t[p]=s[p]}return t};return __assign.apply(this,arguments)};var SubscriptionStatus;(function(SubscriptionStatus){SubscriptionStatus["SUBSCRIBED"]="subscribed";SubscriptionStatus["UNSUBSCRIBED"]="unsubscribed";SubscriptionStatus["UNKNOWN"]="unknown";SubscriptionStatus["BLOCKED"]="blocked"})(SubscriptionStatus||(SubscriptionStatus={}));var WebPush=function(){function WebPush(appId,publicKey,controller,syncInterval){if(controller===void 0){controller="/wpn/default"}if(syncInterval===void 0){syncInterval=1e3*60*10}this.LS={ENDPOINT:"yii2-wpn-endpoint",LAST_SYNC:"yii2-wpn-last_sync"};this.appId=appId;this.publicKey=publicKey;this.controller=controller;this.syncInterval=syncInterval}WebPush.prototype.setupRegistration=function(swPath,successCb,failureCb,shouldMigrate){var _this=this;if(swPath===void 0){swPath="/sw.js"}if(successCb===void 0){successCb=function(status){}}if(failureCb===void 0){failureCb=function(error){}}if(shouldMigrate===void 0){shouldMigrate=function(context){return false}}if(!("serviceWorker"in navigator)){this.log("Service workers are not supported by this browser");return false}else if(!("PushManager"in window)){this.log("Push notifications are not supported by this browser");return false}else if(!("showNotification"in ServiceWorkerRegistration.prototype)){this.log("Notifications are not supported by this browser");return false}else if(Notification.permission==="denied"){this.log("Notifications are denied by the user");return false}navigator.serviceWorker.register(swPath).then(function(){var lastSync=parseInt(localStorage.getItem(_this.LS.LAST_SYNC));var now=Date.now();if(!lastSync||now-lastSync>_this.syncInterval){console.log(now,lastSync,now-lastSync,_this.syncInterval);_this.checkSubscription(successCb,failureCb,shouldMigrate);localStorage.setItem(_this.LS.LAST_SYNC,String(now))}},function(err){_this.log("ServiceWorker registration failed: ",err)})};WebPush.prototype.checkSubscription=function(successCb,failureCb,shouldMigrate){var _this=this;if(successCb===void 0){successCb=function(status){}}if(failureCb===void 0){failureCb=function(error){}}if(shouldMigrate===void 0){shouldMigrate=function(context){return false}}navigator.serviceWorker.ready.then(function(serviceWorkerRegistration){return serviceWorkerRegistration.pushManager.getSubscription()}).then(function(subscription){if(!subscription){successCb(SubscriptionStatus.UNSUBSCRIBED);return}if(shouldMigrate(_this)){return subscription.unsubscribe().then(function(){return navigator.serviceWorker.ready}).then(function(serviceWorkerRegistration){return serviceWorkerRegistration.pushManager.subscribe({userVisibleOnly:true,applicationServerKey:_this.urlBase64ToUint8Array(_this.publicKey)})}).then(function(subscription){return _this.sync(subscription,"POST")})}return _this.sync(subscription,"PUT")}).then(function(subscription){return subscription&&successCb(SubscriptionStatus.SUBSCRIBED)})["catch"](function(e){_this.log("Error when updating the subscription",e);failureCb(e)})};WebPush.prototype.subscribe=function(success,failure){var _this=this;if(success===void 0){success=function(s){}}if(failure===void 0){failure=function(error){}}return this.checkNotificationPermission().then(function(){return navigator.serviceWorker.ready}).then(function(serviceWorkerRegistration){return serviceWorkerRegistration.pushManager.subscribe({userVisibleOnly:true,applicationServerKey:_this.urlBase64ToUint8Array(_this.publicKey)})}).then(function(subscription){localStorage.setItem(_this.LS.ENDPOINT,subscription.endpoint);return _this.sync(subscription,"POST")}).then(function(subscription){return success(subscription)})["catch"](function(e){if(Notification.permission==="denied"){failure("Notifications are denied by the user.")}else{failure("Impossible to subscribe to push notifications : "+e)}})};WebPush.prototype.unsubscribe=function(success,failure){var _this=this;if(success===void 0){success=function(){}}if(failure===void 0){failure=function(){}}navigator.serviceWorker.ready.then(function(serviceWorkerRegistration){return serviceWorkerRegistration.pushManager.getSubscription()}).then(function(subscription){if(!subscription){success();return}return _this.sync(subscription,"DELETE")}).then(function(subscription){return subscription.unsubscribe()}).then(function(){localStorage.removeItem(_this.LS.ENDPOINT);success()})["catch"](function(e){_this.log("Error when unsubscribing the user",e);failure()})};WebPush.prototype.sync=function(subscription,method){var _this=this;var contentEncoding=(PushManager.supportedContentEncodings||["aesgcm"])[0];localStorage.setItem(this.LS.ENDPOINT,subscription.endpoint);return new Promise(function(resolve,reject){$.ajax({url:_this.controller+"/sync?appId="+_this.appId,type:method,data:JSON.stringify(__assign({endpoint:subscription.endpoint,publicKey:_this.encode(subscription.getKey("p256dh")),authToken:_this.encode(subscription.getKey("auth")),contentEncoding:contentEncoding},_this.getCsrfParams())),success:function(result){resolve(subscription)},error:function(err){_this.log("WPN Sync error: ",err);reject(err)}})})};WebPush.prototype.checkNotificationPermission=function(){return new Promise(function(resolve,reject){if(Notification.permission==="denied"){return reject(new Error("Push messages are blocked."))}if(Notification.permission==="granted"){return resolve()}if(Notification.permission==="default"){return Notification.requestPermission().then(function(result){if(result!=="granted"){reject(new Error("Bad permission result"))}else{resolve()}})}return reject(new Error("Unknown permission"))})};WebPush.prototype.urlBase64ToUint8Array=function(base64String){var padding="=".repeat((4-base64String.length%4)%4);var base64=(base64String+padding).replace(/\-/g,"+").replace(/_/g,"/");var rawData=window.atob(base64);var outputArray=new Uint8Array(rawData.length);for(var i=0;i<rawData.length;++i){outputArray[i]=rawData.charCodeAt(i)}return outputArray};WebPush.prototype.getCsrfParams=function(){var _a;return _a={},_a[jQuery("meta[name=csrf-param]").attr("content")]=jQuery("meta[name=csrf-token]").attr("content"),_a};WebPush.prototype.encode=function(str){if(!str){return null}return btoa(String.fromCharCode.apply(null,new Uint8Array(str)))};WebPush.prototype.log=function(){var params=[];for(var _i=0;_i<arguments.length;_i++){params[_i]=arguments[_i]}console.log.apply(console,params)};return WebPush}();yii.confirm=function(message,ok,cancel){$("body").overhang({type:"confirm",message:"<p>"+message+"</p>",primary:"#000000",accent:"#d90000",html:true,overlay:true,yesColor:"#d90000",yesMessage:"Oui",noColor:"#999",noMessage:"Non",overlayColor:"#bcbcbc",closeConfirm:false,callback:function(value){if(value){!ok||ok()}else{!cancel||cancel()}}})};$(function(){$(".breadcrumbs .icon").on("click",function(event){$(".breadcrumbs .siblings").hide();$(this).next(".siblings").show();return document.body.clientWidth<767});$(".breadcrumbs .body_icon").on("click",function(event){$(".breadcrumbs .siblings").hide();$(this).next().next(".siblings").show();return document.body.clientWidth<767});$(document).on("click",function(){$(".breadcrumbs .siblings").hide()})});$(function(){$(".footer-newsletter form").on("submit",function(){$(".footer-newsletter input[type=submit]").prop("disabled",true);$.post($(this).attr("action"),{email:$(this).find('input[type="email"]').val()},function(json){$("body").overhang({custom:true,message:"<p>"+json.message+"</p>",primary:"#000000",accent:json.success?"#27ae60":"#d90000",html:true,closeConfirm:json.closeConfirm||false});if(json.success){$(".footer-newsletter input[type=email]").val("")}$(".footer-newsletter input[type=submit]").prop("disabled",false)});return false})});$(function(){$(".plus").on("click",function(){$(".submenu").hide();$(this).next(".submenu").slideToggle("fast")})});var Facets=function(){function Facets(initialValues,mode){if(initialValues===void 0){initialValues=[]}if(mode===void 0){mode=1}var _this=this;this.topBrands=[];this.countRequest=null;this.mode=1;this.rangeSlider=function(slider,config){var field=$(slider).parents(".field");var range=field.find(".range");var min=range.find(".min");var max=range.find(".max");config=$.extend({snaps:false,range:true,change:function(){_this.updateRangeSelection(field);_this.filtersContainer.find("input").eq(0).change()},slide:function(event,ui){var from=config.snaps?config.snaps[ui.values[0]]:ui.values[0];var to=config.snaps?config.snaps[ui.values[1]]:ui.values[1];min.val(from);max.val(to);_this.updateRangeSelection(field)}},config);$(slider).slider(config);_this.updateRangeSelection(field)};this.bmSelect=function(selector,nb){var selects=$(selector).find(".selects");var brandSelect=$('<select name="brand[]"><option value="">Toutes les marques</option></select>');var availableTopBrands=_this.topBrands.filter(function(b){return _this.brands[b]});if(availableTopBrands.length){availableTopBrands.forEach(function(brandId){brandSelect.append($('<option value="'+brandId+'">'+_this.brands[brandId]+"</option>"))});brandSelect.append($("<option disabled>─────────────</option>"))}Object.keys(_this.brands).forEach(function(brandId){brandSelect.append($('<option value="'+brandId+'">'+_this.brands[brandId]+"</option>"))});var _loop_1=function(i){var buffer=$('<div class="bm bm-'+i+'"'+(i!==0?' style="display: none;"':"")+'"/>');buffer.append($('<div class="select" />').append(brandSelect.clone().on("change",function(event,extra){if(extra===void 0){extra={}}console.log("BM On change",extra);var bm=$(event.target).parents(".bm-"+i);bm.find(".select, .add-row").show();if(!extra.initial){bm.find("select[name*=model]").empty().append('<option disabled selected value="">Chargement ...</option>')}_this.updateBmSelection(bm.parents(".field"))})));buffer.append($('<div class="select" style="display: none;"/>').append($('<select name="model[]"><option value="">Chargement ...</option></select>').on("change",function(){var bm=$(event.target).parents(".bm-"+i);_this.updateBmSelection(bm.parents(".field"));_this.fetchCount()})));if(i!==nb-1){buffer.append($('<button class="btn btn-link btn-block add-row">').hide().text("Ajouter des véhicules").on("click",function(event){var button=$(event.target);button.parents(".bm").next().show();button.remove();event.preventDefault();return false}))}$(selects).append(buffer)};for(var i=0;i<nb;i++){_loop_1(i)}};this.onSubmit=function(event){if(event===void 0){event=null}console.info("onSubmit()");$(".occasions-results").addClass("loading");_this.form.find("input,select").prop("disabled",true);$.pjax.submit(event,"#facets-pjax",{push:true,replace:false,timeout:5e3,scrollTo:false,maxCacheLength:0});if(event){event.preventDefault()}return false};this.fetchCount=function(){console.info("fetchCount()");if(_this.countRequest!==null){console.warn("Canceling previous request");_this.countRequest.abort()}var data=_this.form.serializeArray();console.info("⬆ Fetching count");_this.countRequest=$.post(_this.form.attr("action"),data,function(response){_this.filtersContainer.find(".count").parents("label").addClass("no-results");_this.filtersContainer.find(".count").text(0);if(response.url){if(!_this.form.data("original-action")){console.log("Original form data",_this.form.data("original-action"));_this.form.data("original-action",_this.form.attr("action"));console.log("Original form data",_this.form.data("original-action"))}_this.form.attr("action",response.url)}console.info("⬇ Received count");console.dir(response);Object.keys(response.attributes).forEach(function(key){var attribute=response.attributes[key];if(key==="brand"){var brands=data.filter(function(element){return element.name==="brand[]"});var _loop_2=function(i){var brandSelect=$("select[name*=brand]").eq(i);var currentVal=brandSelect.val();brandSelect.find('option[value!=""]').prop("disabled",true);Object.keys(attribute).forEach(function(brand){brandSelect.find("option[value="+brand+"]").text(attribute[brand]).prop("disabled",false)});brandSelect.val(currentVal)};for(var i=0;i<brands.length;i++){_loop_2(i)}}else{Object.keys(attribute).forEach(function(value){if(key==="model"){var brands=data.filter(function(element){return element.name==="brand[]"});var _loop_3=function(i){if(brands[i].value===value){var brandSelect=$("select[name*=brand]").eq(i);var modelSelect_1=brandSelect.parents(".bm").find("select[name*=model]");var currentVal=modelSelect_1.val();modelSelect_1.find("option").remove();modelSelect_1.append($('<option value="">Tous les modèles</option>'));Object.keys(attribute[value]).forEach(function(model){modelSelect_1.append($('<option value="'+model+'">'+attribute[value][model]+"</option>"))});modelSelect_1.val(currentVal)}};for(var i=0;i<brands.length;i++){_loop_3(i)}}else{var count=attribute[value].match(/ \((\d+)\)$/)[1];var countElement=$("#l-"+key+"-"+value+" .count");if(countElement.text()!=count){countElement.text(count)}}})}});if(response.sql){console.log("%c"+response.sql,"color: green;")}_this.filtersContainer.find(".count").each(function(i,elem){$(elem).parent().toggleClass("no-results",$(elem).text()==="0")});_this.countRequest=null;_this.submitButton.click()})};this.updateAllSelections=function(){console.info("updateAllSelections()");_this.filtersContainer.find(".field").each(function(i,element){var field=$(element);if(field.hasClass("cb")){_this.updateCbSelection(field)}if(field.hasClass("text")){_this.updateTextSelection(field)}})};this.updateRangeSelection=function(field){var min=field.find(".slider").slider("option","min");var max=field.find(".slider").slider("option","max");var snaps=field.find(".slider").slider("option","snaps");var values=field.find(".slider").slider("values");if(values[0]!==min||values[1]!==max){var from=snaps?snaps[values[0]]:values[0];var to=snaps?snaps[values[1]]:values[1];if(from)from+=" "+field.find(".attr-suffix").text();if(to)to+=" "+field.find(".attr-suffix").text();field.addClass("have-selection");if(!from){field.find(".selection").html('<i class="fa fa-chevron-left"></i> '+to)}else if(!to){field.find(".selection").html('<i class="fa fa-chevron-right"></i> '+from)}else if(to===from){field.find(".selection").html('<span class="eq">=</span> '+from)}else{field.find(".selection").html(from+' <i class="fa fa-long-arrow-right"></i> '+to)}}};this.updateInlineFilters=function(){console.info("updateInlineFilters()");$(".inline-filters .filter").remove();$(".selection").each(function(i,j){var html=$(j).html().replace(/<li>/g,"<span>").replace(/\s*<\/li>/g,"</span>");var clearer=$(j).parents(".field").find(".clear-selection");if(html.trim()){var li=$("<li></li>");li.append(html);li.append($('<i class="fa fa-close reset-filter"></i>').on("click",function(e){clearer.click();$(e.target).parents("li").remove()}));$(".inline-filters").append(li)}})};this.updateCbSelection=function(field){var selection=field.find(".selection");selection.empty();field.removeClass("have-selection");field.find("input:checked").each(function(j,checkbox){selection.append($("<li>"+$(checkbox).next("label")[0].childNodes[0].nodeValue+"</li>"));field.addClass("have-selection")})};this.updateBmSelection=function(field){var selection=field.find(".selection");selection.empty();field.removeClass("have-selection");field.find("select[name^=brand] option:selected").each(function(j,option){if($(option).val()){var brand=$(option).text().replace(/ \((\d+)\)$/,"");var model=$(option).parents(".bm").find("select[name^=model] option:selected");if(model.val()&&model.text()!=="Chargement ..."){selection.append($("<li>"+brand+" "+model.text().replace(/ \((\d+)\)$/,"")+"</li>"))}else{selection.append($("<li>"+brand+"</li>"))}field.addClass("have-selection")}})};this.updateTextSelection=function(field){var selection=field.find(".selection");selection.text(field.find("input").val());field.toggleClass("have-selection",!!selection.text().length)};this.clearAllSelections=function(e){console.info("clearAllSelections()");if(e.type==="keydown"&&e.key!=="Enter"&&e.key!==" "){return}_this.unwatchChanges();_this.filtersContainer.find(".field").each(function(i,element){var field=$(element);if(field.hasClass("cb")){_this.clearCheckboxSelection(field)}if(field.hasClass("range-slider")){_this.clearRangeSliderSelection(field)}if(field.hasClass("text")){_this.clearTextSelection(field)}if(field.hasClass("bm-select")){_this.clearBmSelection(field)}field.find(".selection").empty();field.removeClass("have-selection")});_this.watchChanges(true);e.preventDefault();var originalAction=_this.form.data("original-action");if(originalAction){_this.form.attr("action",originalAction)}_this.form.submit();return false};this.clearSelection=function(e){if(e.type==="keydown"&&e.key!=="Enter"&&e.key!==" "){return}var field=$(e.target).parents(".field");_this.unwatchChanges();if(field.hasClass("cb")){_this.clearCheckboxSelection(field)}if(field.hasClass("range-slider")){_this.clearRangeSliderSelection(field)}if(field.hasClass("text")){_this.clearTextSelection(field)}if(field.hasClass("bm-select")){_this.clearBmSelection(field)}field.find(".selection").empty();field.removeClass("have-selection");_this.watchChanges(true)};this.setBrands=function(brands){_this.brands=brands};this.setTopBrands=function(brands){_this.topBrands=brands};this.clearTextSelection=function(field){field.find("input").val("")};this.clearBmSelection=function(field){field.find("select").val("")};this.clearCheckboxSelection=function(field){console.log("Clearing CB #"+field.find("input").eq(0).attr("name"));field.find(":checked").prop("checked",false)};this.clearRangeSliderSelection=function(field){console.log("Clearing RS #"+field.find("input").eq(0).attr("name"));var slider=field.find(".slider");var options=slider.slider("option");console.log("Options",options.min,options.max);slider.slider("values",[options.min,options.max]);field.find(".min").val("");field.find(".max").val("")};this.unwatchChanges=function(){_this.filtersContainer.find("input").off("change")};this.watchChanges=function(trigger){if(trigger===void 0){trigger=false}var firstLoad=false;if(!trigger){firstLoad=true;if(Object.keys(_this.initialValues).length){console.info("Reselecting values");console.table(_this.initialValues);Object.keys(_this.initialValues).forEach(function(key){if(key==="brand"){_this.initialValues.brand.forEach(function(brand,idx){var brandSelect=_this.filtersContainer.find("select[name*=brand]").eq(idx);brandSelect.val(brand);if(_this.initialValues.model&&_this.initialValues.model[idx]){_this.filtersContainer.find("select[name*=model]").eq(idx).empty().append($('<option value="'+_this.initialValues.model[idx]+'">'+_this.initialValues.model[idx].replace(/-/g," ")+"</option>"))}brandSelect.trigger("change",{initial:true});brandSelect.parents(".bm").find(".add-row").trigger("click")})}else{_this.filtersContainer.find("[name="+key+"]").val(_this.initialValues[key])}});_this.filtersContainer.find("input[type=hidden]").remove();if(document.location.search.indexOf("expand")===-1){_this.filtersContainer.find(".field").addClass("off")}}}_this.filtersContainer.find('input[type="checkbox"]').on("change",function(e){return _this.updateCbSelection($(e.target).parents(".field"))});_this.filtersContainer.find(".field.text input").on("change",function(e){return _this.updateTextSelection($(e.target).parents(".field"))});if(trigger){var p=function(){return _this.fetchCount()};if(firstLoad){_this.filtersContainer.find("input, select").on("change",p)}else{console.log("dooooone");_this.filtersContainer.find("input, select").on("change",function(){return _this.fetchCount()})}_this.filtersContainer.find("input").eq(0).trigger("change");if(firstLoad){_this.filtersContainer.find("input, select").off("change",p);_this.filtersContainer.find("input, select").on("change",function(){return _this.fetchCount()})}}else{_this.filtersContainer.find("input, select").on("change",function(){return _this.fetchCount()});_this.updateInlineFilters()}};this.toggleField=function(e){if(e.type==="keydown"&&e.key!=="Enter"&&e.key!==" "){return}$(e.target).parents(".field").toggleClass("off");e.preventDefault();return false};this.filtersContainer=$(".occasions-filter");this.form=this.filtersContainer.find("form");this.submitButton=this.filtersContainer.find('[type="submit"]');this.initialValues=initialValues;this.mode=mode;this.form.on("submit",this.onSubmit);this.filtersContainer.find(".clear-selection").on("click keydown",this.clearSelection);this.filtersContainer.find(".field > span").on("click keydown",this.toggleField);this.filtersContainer.find('[type="reset"]').on("click keydown",this.clearAllSelections);this.filtersContainer.find(".count").each(function(i,elem){if($(elem).text()==="0"){$(elem).parent().addClass("no-results")}});$(document).on("pjax:success",function(){_this.updateInlineFilters();refreshAds()});this.updateAllSelections()}return Facets}();(function(oldConsole){var debug=document.location.hostname!=="www.automobile.tn";if(!window.console||!oldConsole){oldConsole={}}oldConsole.clear();if(!debug){oldConsole.log('%c\n                       ___..............._\n             __.. \' _\'.""""""\\\\""""""""- .`-._\n ______.-\'         (_) |      \\\\           ` \\\\`-. _\n/_       --------------\'-------\\\\---....______\\\\__`.`  -..___\n| T      _.----._           Xxx|x...           |          _.._`--. _\n| |    .\' ..--.. `.         XXX|XXXXXXXXXxx==  |       .\'.---..`.     -._\n\\_j   /  /  __  \\  \\        XXX|XXXXXXXXXXX==  |      / /  __  \\ \\        `-.\n _|  |  |  /  \\  |  |       XXX|""\'            |     / |  /  \\  | |          |\n|__\\_j  |  \\__/  |  L__________|_______________|_____j |  \\__/  | L__________J\n     `\'\\ \\      / ./__________________________________\\ \\      / /___________\\\n        `.`----\'.\'                                     `.`----\'.\'\n          `""""\'                                         `""""\'',"color: #d90000");oldConsole.log("%cBienvenue sur AUTOMOBILE.TN!\n    \nVous avez trouvé un bug ou une faille de sécurité ? 😱\nSoyez constructifs, contactez-nous! ❤️\n📩 "+document.location.origin+"/fr/contact","font-size: 14px; line-height: 20px;");var noop=function(){};window.console={log:noop,dir:noop,warn:noop,error:noop,info:noop,table:noop}}})(window.console);$(function(){$(".more_photos").on("click",function(e){e.stopPropagation();$(".inactive-pic").each(function(index,element){$(element).removeClass("inactive-pic")});$(".more_photos").hide();$(".more_photos").off("click").removeClass("more_photos");$(".grid-gallery").masonry({itemSelector:".grid-item"});return false});var image=new Image;var webSupport=false;function addResult(event){console.log(1);webSupport=event&&event.type==="load"?image.width===1:false;if(webSupport){$("a.grid-item").each(function(index,link){$(link).attr("href",$(link).attr("href").replace(".jpg",".webp").replace(".jpeg",".webp").replace(".png",".webp"));$(link).attr("data-thumb",$(link).data("thumb").replace(".jpg",".webp").replace(".jpeg",".webp").replace(".png",".webp"))})}}image.onerror=addResult;image.onload=addResult;image.src="data:image/webp;base64,UklGRiQAAABXRUJQVlA4IBgAAAAwAQCdASoBAAEAAwA0JaQAA3AA/vuUAAA=";$(".gallery-widget a[data-fancybox=gallery]").fancybox({gutter:0,thumbs:{autoStart:false,axis:"y"},mobile:{thumbs:false},transitionEffect:"slide"});$(".news-details a[data-fancybox=embedded-gallery]").fancybox({gutter:0,thumbs:false,mobile:{thumbs:false},transitionEffect:"slide"});var $grid=$(".grid-gallery").masonry({itemSelector:".grid-item"}).imagesLoaded().progress(function(){$grid.masonry("layout")})});function carousel(selector,config){var owl=$(selector);owl.owlCarousel($.extend({loop:true,autoplay:true,autoplaySpeed:1e3,autoplayHoverPause:true,margin:50,stopOnHover:true,responsiveClass:true,items:4,responsive:{0:{items:1},576:{items:2},768:{items:3},992:{items:4}},nav:true,navText:['<i class="fa fa-caret-left"></i>','<i class="fa fa-caret-right"></i>'],dots:false},config));$("button.owl-prev").attr("aria-label","Previous");$("button.owl-next").attr("aria-label","Next");window.addEventListener("resize",function(){owl.trigger("next.owl.carousel");owl.trigger("prev.owl.carousel")},true);return owl}$(function(){$(".home-search-widget .tabs a").on("click",function(){$(".home-search-widget .tabs a").removeClass("active");$(this).addClass("active");$(".home-search-widget .occasions").toggle($(this).hasClass("occasion"));$(".home-search-widget .versions").toggle($(this).hasClass("neuf"));return false})});$(function(){$("select.model-selector.brand").on("change",function(){var brandSlug=$(this).val();var selector='select[data-models-for="'+$(this).attr("id")+'"]';var modelSelect=$(selector);var modelPrompt=$(this).data("prompt");modelSelect.find("option").remove();modelSelect.append('<option value="">'+modelPrompt+"</option>");if(brandSlug){modelSelect.find("option").remove();modelSelect.append('<option value="">Loading..</option>');modelSelect.prop("disabled","disabled");$.post($(this).data("url"),{brandSlug:brandSlug,stand:$(this).data("stand"),mapToId:modelSelect.data("map-to-id")},function(j){modelSelect.find("option").remove();modelSelect.prop("disabled",false);modelSelect.append('<option value="">'+modelPrompt+"</option>");for(var i=0;i<j.length;i++){modelSelect.append('<option value="'+j[i].id+'">'+j[i].name+"</option>")}modelSelect.trigger("chosen:updated")})}}).chosen();$("select.model-selector.model").on("change",function(){var modelSlug=$(this).val();var brandSelect=$("#"+$(this).data("models-for"));var selector='select[data-versions-for="'+$(this).data("models-for")+'"]';var versionSelect=$(selector);versionSelect.find("option").remove();versionSelect.append('<option value="">'+$(this).data("prompt")+"</option>");if(modelSlug){$.post($(this).data("url"),{brandSlug:brandSelect.val(),modelSlug:modelSlug,stand:$(this).data("stand")},function(j){for(var i=0;i<j.length;i++){versionSelect.append('<option value="'+j[i].id+'">'+j[i].name+"</option>")}versionSelect.trigger("chosen:updated")})}}).chosen();$("select.version").chosen()});$(function(){$(".check-all").on("click",function(){var parent=$("#"+$(this).data("for"));parent.find('input[type="checkbox"]').each(function(i,j){j.checked=!j.checked});return false})});$(function(){var isTop=true;$(window).on("scroll",function(){var lg=992;var gap=document.body.clientWidth>=lg?47:30;var st=$(this).scrollTop();if(isTop&&st>=gap){$("body").addClass("compacted-header");$(".header-root").addClass("fixed-top");isTop=false}else if(st<gap&&!isTop){isTop=true;$("body").removeClass("compacted-header");$(".header-root").removeClass("fixed-top")}if(st>window.innerHeight){$(".back-to-top").fadeIn()}else{$(".back-to-top").fadeOut()}}).scroll();$(".navbar-toggle").on("click",function(){$(".navigation-menu").slideToggle("400")});$(".back-to-top").on("click",function(){$("body,html").animate({scrollTop:0},800);return false})});function scrollToPagination(){var pp=$("body,html");if($(".sorter").length){pp.animate({scrollTop:$(".sorter:first").offset().top-100},800)}}function showSuccess(message){$("body").overhang({custom:true,message:"<p>"+message+"</p>",primary:"#000000",accent:"#108333",html:true,easing:"easeOutQuad",speed:100,duration:5})}function refreshAds(selector){if(selector===void 0){selector="[data-zoneid]"}$(selector).reviveAjax({reviveUrl:"//display.automobile.tn/www/delivery/ajs.php"})}(function(){"use strict";if(typeof window!=="object"){return}if("IntersectionObserver"in window&&"IntersectionObserverEntry"in window&&"intersectionRatio"in window.IntersectionObserverEntry.prototype){if(!("isIntersecting"in window.IntersectionObserverEntry.prototype)){Object.defineProperty(window.IntersectionObserverEntry.prototype,"isIntersecting",{get:function(){return this.intersectionRatio>0}})}return}function getFrameElement(doc){try{return doc.defaultView&&doc.defaultView.frameElement||null}catch(e){return null}}var document=function(startDoc){var doc=startDoc;var frame=getFrameElement(doc);while(frame){doc=frame.ownerDocument;frame=getFrameElement(doc)}return doc}(window.document);var registry=[];var crossOriginUpdater=null;var crossOriginRect=null;function IntersectionObserverEntry(entry){this.time=entry.time;this.target=entry.target;this.rootBounds=ensureDOMRect(entry.rootBounds);this.boundingClientRect=ensureDOMRect(entry.boundingClientRect);this.intersectionRect=ensureDOMRect(entry.intersectionRect||getEmptyRect());this.isIntersecting=!!entry.intersectionRect;var targetRect=this.boundingClientRect;var targetArea=targetRect.width*targetRect.height;var intersectionRect=this.intersectionRect;var intersectionArea=intersectionRect.width*intersectionRect.height;if(targetArea){this.intersectionRatio=Number((intersectionArea/targetArea).toFixed(4))}else{this.intersectionRatio=this.isIntersecting?1:0}}function IntersectionObserver(callback,opt_options){var options=opt_options||{};if(typeof callback!="function"){throw new Error("callback must be a function")}if(options.root&&options.root.nodeType!=1){throw new Error("root must be an Element")}this._checkForIntersections=throttle(this._checkForIntersections.bind(this),this.THROTTLE_TIMEOUT);this._callback=callback;this._observationTargets=[];this._queuedEntries=[];this._rootMarginValues=this._parseRootMargin(options.rootMargin);this.thresholds=this._initThresholds(options.threshold);this.root=options.root||null;this.rootMargin=this._rootMarginValues.map(function(margin){return margin.value+margin.unit}).join(" ");this._monitoringDocuments=[];this._monitoringUnsubscribes=[]}IntersectionObserver.prototype.THROTTLE_TIMEOUT=100;IntersectionObserver.prototype.POLL_INTERVAL=null;IntersectionObserver.prototype.USE_MUTATION_OBSERVER=true;IntersectionObserver._setupCrossOriginUpdater=function(){if(!crossOriginUpdater){crossOriginUpdater=function(boundingClientRect,intersectionRect){if(!boundingClientRect||!intersectionRect){crossOriginRect=getEmptyRect()}else{crossOriginRect=convertFromParentRect(boundingClientRect,intersectionRect)}registry.forEach(function(observer){observer._checkForIntersections()})}}return crossOriginUpdater};IntersectionObserver._resetCrossOriginUpdater=function(){crossOriginUpdater=null;crossOriginRect=null};IntersectionObserver.prototype.observe=function(target){var isTargetAlreadyObserved=this._observationTargets.some(function(item){return item.element==target});if(isTargetAlreadyObserved){return}if(!(target&&target.nodeType==1)){throw new Error("target must be an Element")}this._registerInstance();this._observationTargets.push({element:target,entry:null});this._monitorIntersections(target.ownerDocument);this._checkForIntersections()};IntersectionObserver.prototype.unobserve=function(target){this._observationTargets=this._observationTargets.filter(function(item){return item.element!=target});this._unmonitorIntersections(target.ownerDocument);if(this._observationTargets.length==0){this._unregisterInstance()}};IntersectionObserver.prototype.disconnect=function(){this._observationTargets=[];this._unmonitorAllIntersections();this._unregisterInstance()};IntersectionObserver.prototype.takeRecords=function(){var records=this._queuedEntries.slice();this._queuedEntries=[];return records};IntersectionObserver.prototype._initThresholds=function(opt_threshold){var threshold=opt_threshold||[0];if(!Array.isArray(threshold))threshold=[threshold];return threshold.sort().filter(function(t,i,a){if(typeof t!="number"||isNaN(t)||t<0||t>1){throw new Error("threshold must be a number between 0 and 1 inclusively")}return t!==a[i-1]})};IntersectionObserver.prototype._parseRootMargin=function(opt_rootMargin){var marginString=opt_rootMargin||"0px";var margins=marginString.split(/\s+/).map(function(margin){var parts=/^(-?\d*\.?\d+)(px|%)$/.exec(margin);if(!parts){throw new Error("rootMargin must be specified in pixels or percent")}return{value:parseFloat(parts[1]),unit:parts[2]}});margins[1]=margins[1]||margins[0];margins[2]=margins[2]||margins[0];margins[3]=margins[3]||margins[1];return margins};IntersectionObserver.prototype._monitorIntersections=function(doc){var win=doc.defaultView;if(!win){return}if(this._monitoringDocuments.indexOf(doc)!=-1){return}var callback=this._checkForIntersections;var monitoringInterval=null;var domObserver=null;if(this.POLL_INTERVAL){monitoringInterval=win.setInterval(callback,this.POLL_INTERVAL)}else{addEvent(win,"resize",callback,true);addEvent(doc,"scroll",callback,true);if(this.USE_MUTATION_OBSERVER&&"MutationObserver"in win){domObserver=new win.MutationObserver(callback);domObserver.observe(doc,{attributes:true,childList:true,characterData:true,subtree:true})}}this._monitoringDocuments.push(doc);this._monitoringUnsubscribes.push(function(){var win=doc.defaultView;if(win){if(monitoringInterval){win.clearInterval(monitoringInterval)}removeEvent(win,"resize",callback,true)}removeEvent(doc,"scroll",callback,true);if(domObserver){domObserver.disconnect()}});if(doc!=(this.root&&this.root.ownerDocument||document)){var frame=getFrameElement(doc);if(frame){this._monitorIntersections(frame.ownerDocument)}}};IntersectionObserver.prototype._unmonitorIntersections=function(doc){var index=this._monitoringDocuments.indexOf(doc);if(index==-1){return}var rootDoc=this.root&&this.root.ownerDocument||document;var hasDependentTargets=this._observationTargets.some(function(item){var itemDoc=item.element.ownerDocument;if(itemDoc==doc){return true}while(itemDoc&&itemDoc!=rootDoc){var frame=getFrameElement(itemDoc);itemDoc=frame&&frame.ownerDocument;if(itemDoc==doc){return true}}return false});if(hasDependentTargets){return}var unsubscribe=this._monitoringUnsubscribes[index];this._monitoringDocuments.splice(index,1);this._monitoringUnsubscribes.splice(index,1);unsubscribe();if(doc!=rootDoc){var frame=getFrameElement(doc);if(frame){this._unmonitorIntersections(frame.ownerDocument)}}};IntersectionObserver.prototype._unmonitorAllIntersections=function(){var unsubscribes=this._monitoringUnsubscribes.slice(0);this._monitoringDocuments.length=0;this._monitoringUnsubscribes.length=0;for(var i=0;i<unsubscribes.length;i++){unsubscribes[i]()}};IntersectionObserver.prototype._checkForIntersections=function(){if(!this.root&&crossOriginUpdater&&!crossOriginRect){return}var rootIsInDom=this._rootIsInDom();var rootRect=rootIsInDom?this._getRootRect():getEmptyRect();this._observationTargets.forEach(function(item){var target=item.element;var targetRect=getBoundingClientRect(target);var rootContainsTarget=this._rootContainsTarget(target);var oldEntry=item.entry;var intersectionRect=rootIsInDom&&rootContainsTarget&&this._computeTargetAndRootIntersection(target,targetRect,rootRect);var newEntry=item.entry=new IntersectionObserverEntry({time:now(),target:target,boundingClientRect:targetRect,rootBounds:crossOriginUpdater&&!this.root?null:rootRect,intersectionRect:intersectionRect});if(!oldEntry){this._queuedEntries.push(newEntry)}else if(rootIsInDom&&rootContainsTarget){if(this._hasCrossedThreshold(oldEntry,newEntry)){this._queuedEntries.push(newEntry)}}else{if(oldEntry&&oldEntry.isIntersecting){this._queuedEntries.push(newEntry)}}},this);if(this._queuedEntries.length){this._callback(this.takeRecords(),this)}};IntersectionObserver.prototype._computeTargetAndRootIntersection=function(target,targetRect,rootRect){if(window.getComputedStyle(target).display=="none")return;var intersectionRect=targetRect;var parent=getParentNode(target);var atRoot=false;while(!atRoot&&parent){var parentRect=null;var parentComputedStyle=parent.nodeType==1?window.getComputedStyle(parent):{};if(parentComputedStyle.display=="none")return null;if(parent==this.root||parent.nodeType==9){atRoot=true;if(parent==this.root||parent==document){if(crossOriginUpdater&&!this.root){if(!crossOriginRect||crossOriginRect.width==0&&crossOriginRect.height==0){parent=null;parentRect=null;intersectionRect=null}else{parentRect=crossOriginRect}}else{parentRect=rootRect}}else{var frame=getParentNode(parent);var frameRect=frame&&getBoundingClientRect(frame);var frameIntersect=frame&&this._computeTargetAndRootIntersection(frame,frameRect,rootRect);if(frameRect&&frameIntersect){parent=frame;parentRect=convertFromParentRect(frameRect,frameIntersect)}else{parent=null;intersectionRect=null}}}else{var doc=parent.ownerDocument;if(parent!=doc.body&&parent!=doc.documentElement&&parentComputedStyle.overflow!="visible"){parentRect=getBoundingClientRect(parent)}}if(parentRect){intersectionRect=computeRectIntersection(parentRect,intersectionRect)}if(!intersectionRect)break;parent=parent&&getParentNode(parent)}return intersectionRect};IntersectionObserver.prototype._getRootRect=function(){var rootRect;if(this.root){rootRect=getBoundingClientRect(this.root)}else{var html=document.documentElement;var body=document.body;rootRect={top:0,left:0,right:html.clientWidth||body.clientWidth,width:html.clientWidth||body.clientWidth,bottom:html.clientHeight||body.clientHeight,height:html.clientHeight||body.clientHeight}}return this._expandRectByRootMargin(rootRect)};IntersectionObserver.prototype._expandRectByRootMargin=function(rect){var margins=this._rootMarginValues.map(function(margin,i){return margin.unit=="px"?margin.value:margin.value*(i%2?rect.width:rect.height)/100});var newRect={top:rect.top-margins[0],right:rect.right+margins[1],bottom:rect.bottom+margins[2],left:rect.left-margins[3]};newRect.width=newRect.right-newRect.left;newRect.height=newRect.bottom-newRect.top;return newRect};IntersectionObserver.prototype._hasCrossedThreshold=function(oldEntry,newEntry){var oldRatio=oldEntry&&oldEntry.isIntersecting?oldEntry.intersectionRatio||0:-1;var newRatio=newEntry.isIntersecting?newEntry.intersectionRatio||0:-1;if(oldRatio===newRatio)return;for(var i=0;i<this.thresholds.length;i++){var threshold=this.thresholds[i];if(threshold==oldRatio||threshold==newRatio||threshold<oldRatio!==threshold<newRatio){return true}}};IntersectionObserver.prototype._rootIsInDom=function(){return!this.root||containsDeep(document,this.root)};IntersectionObserver.prototype._rootContainsTarget=function(target){return containsDeep(this.root||document,target)&&(!this.root||this.root.ownerDocument==target.ownerDocument)};IntersectionObserver.prototype._registerInstance=function(){if(registry.indexOf(this)<0){registry.push(this)}};IntersectionObserver.prototype._unregisterInstance=function(){var index=registry.indexOf(this);if(index!=-1)registry.splice(index,1)};function now(){return window.performance&&performance.now&&performance.now()}function throttle(fn,timeout){var timer=null;return function(){if(!timer){timer=setTimeout(function(){fn();timer=null},timeout)}}}function addEvent(node,event,fn,opt_useCapture){if(typeof node.addEventListener=="function"){node.addEventListener(event,fn,opt_useCapture||false)}else if(typeof node.attachEvent=="function"){node.attachEvent("on"+event,fn)}}function removeEvent(node,event,fn,opt_useCapture){if(typeof node.removeEventListener=="function"){node.removeEventListener(event,fn,opt_useCapture||false)}else if(typeof node.detatchEvent=="function"){node.detatchEvent("on"+event,fn)}}function computeRectIntersection(rect1,rect2){var top=Math.max(rect1.top,rect2.top);var bottom=Math.min(rect1.bottom,rect2.bottom);var left=Math.max(rect1.left,rect2.left);var right=Math.min(rect1.right,rect2.right);var width=right-left;var height=bottom-top;return width>=0&&height>=0&&{top:top,bottom:bottom,left:left,right:right,width:width,height:height}||null}function getBoundingClientRect(el){var rect;try{rect=el.getBoundingClientRect()}catch(err){}if(!rect)return getEmptyRect();if(!(rect.width&&rect.height)){rect={top:rect.top,right:rect.right,bottom:rect.bottom,left:rect.left,width:rect.right-rect.left,height:rect.bottom-rect.top}}return rect}function getEmptyRect(){return{top:0,bottom:0,left:0,right:0,width:0,height:0}}function ensureDOMRect(rect){if(!rect||"x"in rect){return rect}return{top:rect.top,y:rect.top,bottom:rect.bottom,left:rect.left,x:rect.left,right:rect.right,width:rect.width,height:rect.height}}function convertFromParentRect(parentBoundingRect,parentIntersectionRect){var top=parentIntersectionRect.top-parentBoundingRect.top;var left=parentIntersectionRect.left-parentBoundingRect.left;return{top:top,left:left,height:parentIntersectionRect.height,width:parentIntersectionRect.width,bottom:top+parentIntersectionRect.height,right:left+parentIntersectionRect.width}}function containsDeep(parent,child){var node=child;while(node){if(node==parent)return true;node=getParentNode(node)}return false}function getParentNode(node){var parent=node.parentNode;if(node.nodeType==9&&node!=document){return getFrameElement(node)}if(parent&&parent.nodeType==11&&parent.host){return parent.host}if(parent&&parent.assignedSlot){return parent.assignedSlot.parentNode}return parent}window.IntersectionObserver=IntersectionObserver;window.IntersectionObserverEntry=IntersectionObserverEntry})();$(function(){var phone=document.querySelector(".btn-main-phone");if(phone){var observer=new IntersectionObserver(function(entries){console.log("observer",entries[0]);if(entries[0].intersectionRatio===0){document.querySelector(".floating-infos").classList.remove("hide")}else if(entries[0].intersectionRatio===1){document.querySelector(".floating-infos").classList.add("hide")}},{threshold:[0,1]});observer.observe(phone)}$.ajaxSetup({headers:{"X-CSRF-Token":yii.getCsrfToken()}});var lazyImages=document.querySelectorAll("img[data-src]");if(window.caches){var lazyImages_1=Array.prototype.slice.call(document.querySelectorAll("img[data-src]"));Promise.all(lazyImages_1.map(function(img){var src=img.getAttribute("data-src");return window.caches.match(src).then(function(response){if(response){console.log("here");img.setAttribute("src",src);img.setAttribute("alt",img.getAttribute("data-alt"));img.removeAttribute("data-src");img.removeAttribute("data-alt")}})})).then(initialiseLazyLoading)}else{initialiseLazyLoading()}function initialiseLazyLoading(){var lazyImages=document.querySelectorAll("img[data-src]");console.log("init");lazySizes.init()}$(".occasions-filter legend").on("click",function(){$(this).toggleClass("open");$(".fields").slideToggle("fast");return false});$("ul#carrosserie").buttonset();$("div.occasions-filter form, .home-search-widget form, .search-engine-widget form").on("submit",function(e){$(this).find('select:not(".model-selector"), input').filter(function(){return!$.trim($(this).val()).length}).prop("disabled",true);$(document).on("pjax:complete",function(){$(this).find("select, input").prop("disabled",false)})});$(document).on("click",".mobile-filter",function(){$(".occasions-filter").slideToggle(function(){document.getElementById("super_content_container").scrollIntoView()}).toggleClass("visible");$("body").toggleClass("filters-visible");return false});$(document).on("click",".mobile-show-results",function(){$(".occasions-filter").removeClass("visible").css("display","");$("body").removeClass("filters-visible");return false});$(document).on("click",".format a",function(){$.ajax($(this).attr("href")).always(function(){$(".occasions-results").toggleClass("layout-list").toggleClass("layout-thumb");$(".format a").toggleClass("active")});return false});$(document).on("click",".btn-renew",function(e){$.post($(this).attr("href"),function(date){showSuccess("Votre annonce a été renouvelée");$(e.target).parent(".occasion-buttons").prev(".occasion-expiration").find("b").css({color:"green"}).text(date)});return false});$("input[id$=email]").on("blur",function(e){var target=$(e.target);var group=target.parents(".form-group");var hint=group.find(".help-block");hint.html('<i class="fa fa-spin fa-spinner"></i>');$.post({url:"/fr/site/test-email",data:{email:target.val()},success:function(json){if(target.val()===json.email){if(!json.valid){group.addClass("hasErrors");target.css("border-color","#a94442");hint.text("Votre email semble invalide, revérifiez-le.")}else{group.removeClass("hasErrors");hint.text("");target.css("border-color","")}}}})})});function openNewWindow(page,nom,hauteur,largeur){var options="height="+hauteur+",width="+largeur+",left=2, top=2,toolbar=no,scrollbars=yes";window.open(page,nom,options)}
